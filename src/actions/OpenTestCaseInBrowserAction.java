package actions;

import com.codepine.api.testrail.model.Case;
import com.intellij.openapi.actionSystem.AnAction;
import com.intellij.openapi.actionSystem.AnActionEvent;
import utils.GuiUtil;
import view.TestRailWindow;

import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.TreePath;
import java.util.Arrays;

public class OpenTestCaseInBrowserAction extends AnAction {
    private static final String ICON = "browser.png";

    public OpenTestCaseInBrowserAction() {
        super("Open in browser", "Open selected test case in a browser", GuiUtil.loadIcon(ICON));
    }

    @Override
    public void actionPerformed(AnActionEvent e) {
        TestRailWindow.getInstance(e.getProject()).openSelectedTestCaseInBrowser();
    }

    @Override
    public void update(AnActionEvent e) {
        TreePath[] paths = TestRailWindow.getInstance(e.getProject()).getSectionTree().getSelectionPaths();
        if (paths == null || paths.length > 1) {
            e.getPresentation().setEnabled(false);
        }
        if (paths != null && paths.length == 1) {
            boolean notACase = Arrays.stream(paths).noneMatch(treePath -> ((DefaultMutableTreeNode) treePath.getLastPathComponent()).getUserObject() instanceof Case);
            if (notACase) {
                e.getPresentation().setEnabled(false);
            } else {
                e.getPresentation().setEnabled(true);
            }
        }
    }
}
